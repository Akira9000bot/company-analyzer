# 2026-02-25 - Context Management and Heartbeat Optimization

## Context Bloat Issue
- **Observation:** The `main` session context reached ~961,000 tokens (96% of the 1M limit).
- **Problem:** Every turn (user message or heartbeat) sends the entire history, hitting Google Gemini 3 Flash TPM limits and causing 503 errors.
- **Diagnosis:** Heartbeats were running in the same `main` session as user chat, preventing the context from truly "pruning" or "sleeping".

## Implemented "Standard Protocol" for Context Reduction
1. **Isolated Heartbeats:** Configured heartbeats to run in a dedicated `heartbeat` session. This prevents periodic system checks from carrying the heavy baggage of main conversation history.
2. **Daily Session Reset:** Enabled an automatic session reset at 04:00 daily to ensure the context window remains fresh.
3. **Aggressive Pruning:** Reduced `contextPruning.ttl` from 30m to 10m to clear the cache faster during periods of inactivity.
4. **Memory-First Architecture:** Reinforced the requirement to move all long-term takeaways to `MEMORY.md` before a session reset occurs.

## Action Items
- [x] Configure heartbeat session isolation.
- [x] Configure daily auto-reset for main session.
- [x] Update documentation in `AGENTS.md` regarding session rotation.
- [ ] Monitor TPM usage over the next 24 hours.

Source: memory/2026-02-25.md
